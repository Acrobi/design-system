# Tailwind CSS v4 Migration Guide

## Overview

This document outlines the migration of the Acrobi Design System from Tailwind CSS v3 (HSL-based) to Tailwind CSS v4 (hex-based) color system.

## Key Changes

### 1. Color Format Conversion

- **Before**: HSL values in CSS custom properties (`hsl(270 83% 61%)`)
- **After**: Hex values in CSS custom properties (`#9333ea`)
- **Benefit**: Better compatibility with Tailwind CSS v4 `@theme` block

### 2. Updated globals.css Structure

The `globals.css` file has been completely restructured:

```css
@theme {
  /* Map semantic tokens to Tailwind utilities (hex format for v4 compatibility) */
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-primary: var(--primary);
  /* ... and so on for all colors */

  /* Extended color palette - direct hex access */
  --color-gray-50: var(--n50);
  --color-blue-500: var(--blue-500);
  --color-purple-600: var(--p600);
  /* ... complete color palette */
}
```

### 3. Tailwind Configuration Updates

The `tailwind.config.js` now references the `@theme` variables:

```javascript
module.exports = {
  // ... config remains mostly the same
  colors: {
    // Semantic tokens
    primary: "var(--primary)",
    background: "var(--background)",

    // Extended palette now references @theme block
    'gray-50': 'var(--color-gray-50)',
    'blue-500': 'var(--color-blue-500)',
    'purple-600': 'var(--color-purple-600)',
    // ... and so on
  }
}
```

## Migration Benefits

### 1. **Tailwind CSS v4 Compatibility**
- Full support for the new `@theme` directive
- Better integration with Tailwind's color utilities
- Future-proof design system architecture

### 2. **Improved Performance**
- Direct hex values reduce CSS parsing overhead
- Better browser optimization
- Smaller CSS bundle size

### 3. **Enhanced Developer Experience**
- Clearer color values in dev tools
- Better debugging capabilities
- More predictable color behavior

## Color Architecture

### Three-Tier Token System

1. **Primitive Tokens** (`--p50`, `--n100`, etc.)
   - Raw hex values
   - Never used directly in components
   - Foundation of the color system

2. **Semantic Tokens** (`--primary`, `--background`, etc.)
   - Map primitives to UI purposes
   - Used in component styling
   - Change per theme (light/dark)

3. **Utility Classes** (`bg-primary`, `text-background`)
   - Generated by Tailwind from semantic tokens
   - Used in JSX/TSX components
   - Automatic theme switching

### Light/Dark Theme Support

```css
/* Light theme (default) */
:root {
  --background: #ffffff;
  --foreground: #171717;
  --primary: #9333ea;
  /* ... other colors */
}

/* Dark theme */
.dark {
  --background: #0a0a0a;
  --foreground: #fafafa;
  --primary: #c084fc;
  /* ... other colors */
}
```

## Usage Guide

### 1. Component Development

Use semantic color tokens in your components:

```tsx
// ✅ Correct - Use semantic tokens
<button className="bg-primary text-primary-foreground px-4 py-2">
  Click me
</button>

// ❌ Incorrect - Don't use hard-coded colors
<button className="bg-purple-600 text-white px-4 py-2">
  Click me
</button>

// ✅ Correct - Use extended palette when needed
<div className="bg-purple-100 text-purple-900 p-4">
  Highlighted content
</div>
```

### 2. Theme Management

Use the provided theme utilities:

```tsx
import { getTheme, setTheme, toggleTheme, getCurrentThemeColors } from '@/lib/theme-utils';

// Get current theme
const currentTheme = getTheme(); // 'light' | 'dark' | 'system'

// Set theme
setTheme('dark');
setTheme('light');
setTheme('system');

// Toggle theme
toggleTheme();

// Get current colors
const colors = getCurrentThemeColors();
console.log(colors.primary); // '#9333ea' or '#c084fc'
```

### 3. Color Validation

Validate theme compatibility:

```tsx
import { validateThemeColors, getThemeCompatibilityReport } from '@/lib/theme-utils';

// Check if all colors are in hex format
const isValid = validateThemeColors();

// Get detailed compatibility report
const report = getThemeCompatibilityReport();
console.log(report.isCompatible); // boolean
console.log(report.issues); // string[]
console.log(report.recommendations); // string[]
```

## Color Palette

### Brand Colors (Purple)
- **Primary**: `#9333ea` (light), `#c084fc` (dark)
- **Scale**: `#faf5ff` → `#3b0764` (50 → 950)

### Neutral Colors (Gray)
- **Background**: `#ffffff` (light), `#0a0a0a` (dark)
- **Foreground**: `#171717` (light), `#fafafa` (dark)
- **Scale**: `#fafafa` → `#0a0a0a` (50 → 950)

### Extended Colors
- **Blue**: `#eff6ff` → `#172554` (50 → 950)
- **Green**: `#f0fdf4` → `#052e16` (50 → 950)
- **Red**: `#fef2f2` → `#450a0a` (50 → 950)
- **Orange**: `#fff7ed` → `#431407` (50 → 950)

## Testing

### 1. Color Test Page

Visit `/color-test` to see comprehensive color testing:

```bash
npm run dev
# Navigate to http://localhost:3000/color-test
```

This page shows:
- All semantic color combinations
- Extended color palettes
- UI component examples
- Theme switching functionality
- Border and ring color testing

### 2. Build Verification

```bash
npm run build
npm run lint
```

Both commands should pass without errors.

### 3. Browser Testing

Test in multiple browsers to ensure:
- Color rendering is consistent
- Theme switching works correctly
- No CSS parsing errors
- Proper color contrast

## Troubleshooting

### Common Issues

1. **"Unknown at rule @theme" warnings**
   - This is expected in some editors
   - Does not affect functionality
   - Ignore these warnings

2. **Colors not applying**
   - Ensure `@import "tailwindcss";` is at the top of `globals.css`
   - Check that `@theme` block is properly formatted
   - Verify no CSS syntax errors

3. **Theme switching not working**
   - Ensure `darkMode: ["class"]` is in `tailwind.config.js`
   - Check that semantic tokens are defined in both `:root` and `.dark`
   - Verify theme management functions are called correctly

### Validation

Use the built-in validation tools:

```tsx
import { getThemeCompatibilityReport } from '@/lib/theme-utils';

const report = getThemeCompatibilityReport();
if (!report.isCompatible) {
  console.error('Theme compatibility issues:', report.issues);
  console.log('Recommendations:', report.recommendations);
}
```

## Migration Checklist

- [x] Convert all HSL values to hex format
- [x] Update `globals.css` with `@theme` block
- [x] Modify `tailwind.config.js` for v4 compatibility
- [x] Add theme management utilities
- [x] Create comprehensive color test page
- [x] Update documentation
- [x] Verify build process
- [x] Test theme switching
- [x] Validate color contrast

## Future Considerations

1. **Dynamic Theme Generation**
   - Use `generateThemeFromColors()` for custom themes
   - Support for client-specific branding
   - Runtime theme switching

2. **Accessibility Enhancements**
   - Automatic contrast checking
   - Reduced motion support
   - High contrast mode support

3. **Performance Optimization**
   - CSS-in-JS for dynamic theming
   - Color palette caching
   - Optimized bundle size

## Support

For questions or issues related to the Tailwind CSS v4 migration:

1. Check this documentation first
2. Review the color test page examples
3. Use the validation utilities for debugging
4. Refer to the Tailwind CSS v4 documentation

---

**Note**: This migration maintains full backward compatibility while providing future-proof support for Tailwind CSS v4. All existing components should continue to work without changes.